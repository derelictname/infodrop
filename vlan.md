# vlan

VLAN является дополнением к Ethernet пакету в виде числа, которое позволяет использовать его для программного разделения трафика на разные широковещательные домены.

Управляемые коммутаторы позволяют назначить номер VLAN на любой порт. В результате приходящий на этот порт трафик будет считаться относящимся к этому VLAN и передаваться только в порты с таким же VLAN (в дополнение к проверке таблицы MAC-адресов). Такие порты называют **access/untagged**.

Но можно настроить порт передавать номер VLAN в пакете, тогда устройство-приёмник (другой коммутатор или сервер) будет получать информацию об этом программном разделении и соответственно применять её. Такие порты называются **trunk/tagged**.

Есть особенный VLAN 1, для которого номер не вставляется в Ethernet пакет. Соответственно полученный trunk/tagged порту на пакет без номера будет отнесён к VLAN 1. Это нужно, чтобы не нарушить работу оборудования, которое не воспринимает это изменение в пакете.

Прослушивание интерфейса на наличие VLAN в пакетах

    while true; do tcpdump -ni vmbr0 -e 2> /dev/null | grep -Eo 'vlan [0-9]+' | head -n 1000 | sort | uniq -c | sort -n; done

## Настройка

Временно

```bash
modprobe 8021q
ip l a link enp1s0f0 name vlan12 type vlan id 12
ip a a 12.34.56.78/24 dev vlan12
ip l set up vlan12
ping 12.34.56.1
ip -s a
ip r a default via 12.34.56.1
```

Постоянно

```
auto vlan12
iface vlan12 inet static
address 12.34.56.78
netmask 255.255.255.0
vlan_raw_device enp1s0f0
```
